(this.webpackJsonpktool=this.webpackJsonpktool||[]).push([[40],{1736:function(e,t,a){"use strict";a.r(t);a(85);var n,c,s=a(44),r=a(8),i=a(15),o=a(5),u=a(42),l=a(0),b=a(1743),j=a(135),h=a(31),f=a(2),d=a(48),O=a(677),p=a.n(O),g=a(49),C=a(28),v=a(21),m=a(69),x=a.p+"static/media/chatGPT.e60787aa.svg",y=a(18),I=a(19),M=a(16),k={conversationId:"",parentMessageId:""},A=new(function(){function e(){var t=this;Object(y.a)(this,e),this.chatMessageList=[],this.chatMessageConf=Object(f.a)({},k),this.openAIKey="",this.openAIMsgId="",this.init=Object(i.a)(Object(r.a)().mark((function e(){var a,n;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(v.b)(C.a.ChatGPTUserKeyCache);case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0="";case 6:return a=e.t0,e.next=9,Object(v.b)(C.a.ChatGPTMessageCache);case 9:if(e.t1=e.sent,e.t1){e.next=12;break}e.t1="[]";case 12:n=e.t1,Object(M.p)((function(){t.openAIKey=a,t.chatMessageList=JSON.parse(n)})),e.next=18;break;case 16:e.prev=16,e.t2=e.catch(0);case 18:case"end":return e.stop()}}),e,null,[[0,16]])}))),this.saveGPTMessageCache=Object(M.f)((function(e){var a=t.chatMessageList.reverse().filter((function(e,t){return t<49})).reverse();a.push(e),t.chatMessageList=a,Object(v.e)(C.a.ChatGPTMessageCache,JSON.stringify(a))})),this.updateOpenAIConf=Object(M.f)((function(e){t.openAIKey=e,Object(v.e)(C.a.ChatGPTUserKeyCache,e)})),this.deleteOpenAIConf=Object(M.f)((function(){t.openAIKey="",Object(v.e)(C.a.ChatGPTUserKeyCache,"")})),this.updateOpenAIMsgId=Object(M.f)((function(e){t.openAIMsgId=e})),this.updateChatMessageConf=Object(M.f)((function(e){t.chatMessageConf=Object(f.a)({},e)})),this.deleteChatMessageConf=function(){t.chatMessageConf=Object(f.a)({},k)},Object(M.n)(this,{openAIKey:M.o,openAIMsgId:M.o,chatMessageList:M.o,chatMessageConf:M.o,isUseCustom:M.g})}return Object(I.a)(e,[{key:"isUseCustom",get:function(){return!!this.openAIKey}}]),e}()),K=a(3);!function(e){e.JoinService="JoinService",e.UseNotice="UseNotice",e.AboutCache="AboutCache",e.CleanCache="CleanCache",e.UseSelfKey="UseSelfKey"}(c||(c={}));var T=[{code:c.UseSelfKey,name:"\u4e13\u5c5e\u6a21\u5f0f"},{code:c.JoinService,name:"\u63a5\u5165\u670d\u52a1"},{code:c.UseNotice,name:"\u5b89\u5168\u987b\u77e5"},{code:c.AboutCache,name:"\u5173\u4e8e\u6570\u636e\u7f13\u5b58"},{code:c.CleanCache,name:"\u6e05\u9664\u7f13\u5b58"}],N=(n={},Object(K.a)(n,c.JoinService,"\u63a5\u5165ChatGPT\u670d\u52a1\uff0c\u53ef\u4ee5\u8054\u7cfb \u6b27\u9633\u667a\u8d85(ouyangzhichao)"),Object(K.a)(n,c.UseNotice,["\u6697\u85cf\u7684\u5b89\u5168\u9690\u60a3","\u5b89\u5168\u5a01\u80c1\u5df2\u7ecf\u6216\u6b63\u5728\u53d1\u751f\uff0c\u5c3d\u7ba1ChatGPI\u672c\u8eab\u5c1a\u4e0d\u5177\u5907\u76f4\u63a5\u653b\u51fb\u7f51\u7edc\u5b89\u5168\u548c\u6570\u636e\u5b89\u5168\u7684\u80fd\u529b\uff0c\u4f46\u662f\u7531\u4e8e\u5b83\u5177\u6709\u81ea\u7136\u8bed\u8a00\u751f\u6210\u548c\u7406\u89e3\u7684\u80fd\u529b\uff0c\u53ef\u4ee5\u88ab\u7528\u4e8e\u4f2a\u9020\u865a\u5047\u4fe1\u606f\u3001\u653b\u51fb\u793e\u4ea4\u5de5\u7a0b\u7b49\u65b9\u9762\u3002\u5728\u81ea\u52a8\u5316\u3001AI\u201c\u653b\u51fb\u5373\u670d\u52a1\u201d\u7b49\u6280\u672f\u548c\u6a21\u5f0f\u52a0\u6301\u4e0b\uff0c\u7f51\u7edc\u5b89\u5168\u653b\u51fb\u661f\u73b0\u51fa\u66b4\u6da8\u8d8b\u52bf\u3002","\u53e6\u4e00\u65b9\u9762\uff0c\u8ddd\u79bb\u7528\u6237\u66f4\u8fd1\u7684\u98ce\u9669\u662f\uff0c\u7528\u6237\u5728\u4f7f\u7528ChatGPT\u7b49AI\u5177\u65f6\uff0c\u53ef\u80fd\u4f1a\u4e0d\u7ecf\u610f\u95f4\u5c06\u79c1\u5bc6\u6570\u636e\u8f93\u5165\u5230\u4e91\u7aef\u6a21\u578b\uff0c\u8fd9\u6b64\u6570\u636e\u53ef\u80fd\u6210\u4e3a\u8bad\u7ec3\u6570\u636e\uff0c\u4e5f\u53ef\u80fd\u6210\u4e3a\u63d0\u4f9b\u7ed9\u4ed6\u4eba\u7b54\u6848\u7684\u4e00\u90e8\u5206\uff0c\u4ece\u800c\u5bfc\u81f4\u6570\u636e\u6cc4\u9732\u548c\u5408\u89c4\u98ce\u9669\u3002"].join("\r\n")),Object(K.a)(n,c.AboutCache,"\u4e3a\u4e86\u4fdd\u969c\u60a8\u7684\u6301\u7eed\u4f7f\u7528\u4f53\u9a8c\uff0c\u6211\u4eec\u9ed8\u8ba4\u5bf9\u6570\u636e\u8fdb\u884c\u4e86\u7f13\u5b58\uff0c\u4ee5\u4fbf\u60a8\u4e0b\u4e00\u6b21\u80fd\u591f\u56de\u6eaf\u81ea\u5df1\u7684\u5386\u53f2\u8bb0\u5f55\uff08\u6700\u591a50\u6761\uff09\u3002\u60a8\u53ef\u4ee5\u9009\u62e9\u300c\u6e05\u9664\u7f13\u5b58\u300d\u6765\u5220\u9664\u6570\u636e\u3002"),Object(K.a)(n,c.CleanCache,"\u6b63\u5728\u6e05\u9664\u6570\u636e\uff0c\u8bf7\u7a0d\u540e~"),n),S=function(e,t){A.deleteChatMessageConf(),Object(v.e)(C.a.ChatGPTMessageCache,"[]"),setTimeout((function(){e([]),t(G("\u7f13\u5b58\u5df2\u6e05\u9664\uff01"))}),1e3)},w=function(){var e=Object(i.a)(Object(r.a)().mark((function e(t){var a,n;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,g.a.post("".concat(h.f,"/rest/chatGPT/sendMessage"),Object(f.a)(Object(f.a)({text:t},A.chatMessageConf),{},{apiKey:A.openAIKey}),{timeout:18e4});case 3:return a=e.sent,n=a.data,A.updateChatMessageConf({conversationId:n.conversationId,parentMessageId:n.id}),e.abrupt("return",n.detail.choices);case 9:return e.prev=9,e.t0=e.catch(0),e.abrupt("return",[{text:"\u554a\u54e6\uff0c\u82ad\u6bd4Q\u4e86~",status:"fail"}]);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}(),P=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sent";return{type:"text",content:{text:e},position:"right",user:{avatar:Object(m.b)().photo},status:t}},G=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sent";return{type:arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text",content:{text:e.replace(/\r|\n/,"")},user:{avatar:x},status:t}},U=a(17),J=a(536),L=a(1751),z=a(1745),_=(a(109),a(41)),E=(a(298),a(88)),R=(a(271),a(130)),q=a(678),F=a.n(q),H=a(1),Q=[{required:!0,message:"\u8bf7\u586b\u5199\u5185\u5bb9"}],B=function(e){var t=e._id,a=e.updateMsg,n=Object(l.useCallback)((function(e){a(t,G("\u5df2\u4fdd\u5b58\u8bbe\u7f6e\uff0c\u5e76\u5df2\u542f\u7528\u201c\u4e13\u5c5e\u6a21\u5f0f\u201d")),A.updateOpenAIConf(e.apiKey)}),[t,a]),c=Object(l.useCallback)((function(){a(t,G("\u5df2\u6e05\u9664\u8bbe\u7f6e\uff0c\u5e76\u5df2\u6062\u590d\u201c\u666e\u901a\u6a21\u5f0f\u201d")),A.deleteOpenAIConf()}),[t,a]);return Object(l.useEffect)((function(){A.updateOpenAIMsgId(t)}),[t]),Object(H.jsxs)("div",{className:"Bubble ".concat(F.a.selfCard),children:[Object(H.jsxs)("div",{className:F.a.notice,children:[Object(H.jsx)("b",{children:"\u4e13\u5c5e\u6a21\u5f0f\u8bf4\u660e\uff1a"}),Object(H.jsx)("br",{}),Object(H.jsx)("br",{}),"\u542f\u7528\u4e13\u5c5e\u6a21\u5f0f\uff0c\u53ea\u9700\u8981\u8f93\u5165\u81ea\u884c\u7533\u8bf7\u7684OpenAI Key\u5373\u53ef\u3002",Object(H.jsx)("br",{}),"\u63d0\u793a\uff1aKey\u4e0d\u662f\u60a8\u7684OpenAI\u90ae\u7bb1\u8d26\u53f7\u54e6\uff01\u5982\u4e0b\u56fe\u6240\u793a\uff0c",Object(H.jsx)("a",{href:"https://platform.openai.com/account/api-keys",target:"_blank",rel:"noreferrer",children:"\u70b9\u51fb\u8fd9\u91cc\u53bb\u521b\u5efa"}),"\u3002",Object(H.jsx)("img",{src:"https://static.yximgs.com/udata/pkg/ks-ad-fe/chrome-plugin-upload/2023-04-24/1682338300242.47e52700a66c4f56.png",alt:""}),"\u8bf7\u5728\u4e0b\u65b9\u8f93\u5165\u60a8\u7684OpenAI\u4fe1\u606f\uff08KTool\u975e\u5e38\u5c0a\u91cd\u53ca\u4fdd\u62a4\u60a8\u7684\u4e2a\u4eba\u9690\u79c1\uff09\u3002"]}),Object(H.jsxs)(E.a,{className:F.a.form,layout:"vertical",onFinish:n,initialValues:{apiKey:A.openAIKey},children:[Object(H.jsx)(E.a.Item,{label:"API Key",name:"apiKey",rules:Q,children:Object(H.jsx)(R.a,{allowClear:!0,maxLength:200})}),Object(H.jsxs)(E.a.Item,{className:F.a.actions,children:[Object(H.jsx)(_.a,{type:"primary",size:"middle",htmlType:"submit",children:"\u4fdd\u5b58\u914d\u7f6e"}),Object(H.jsx)(_.a,{type:"primary",size:"middle",onClick:c,children:"\u4e00\u952e\u6062\u590d"})]})]})]})},V=["node","inline","className","children"],X=function(e){var t=e.content,a=Object(l.useCallback)((function(e){e.node;var t=e.inline,a=e.className,n=e.children,c=Object(U.a)(e,V),s=/language-(\w+)/.exec(a||"");return!t&&s?Object(H.jsx)(L.a,Object(f.a)({children:String(n).replace(/\n$/,""),style:z.a,language:s[1],PreTag:"div"},c)):Object(H.jsx)("code",Object(f.a)(Object(f.a)({className:a},c),{},{children:n}))}),[]);return Object(H.jsx)(O.Bubble,{content:Object(H.jsx)(J.a,{children:t.text,className:F.a.markdown,components:{code:a}})})},Y=function(e){return"useSelf"===e.type?Object(H.jsx)(B,Object(f.a)({},e)):Object(H.jsx)(X,Object(f.a)({},e))},Z=(a(835),function(e){var t=e.list,a=Object(l.useRef)(null),n=Object(l.useState)(!1),s=Object(o.a)(n,2),u=s[0],b=s[1],j=Object(l.useState)(null),h=Object(o.a)(j,2),g=h[0],C=h[1],v=Object(O.useMessages)(t),m=v.messages,x=v.appendMsg,y=v.updateMsg,I=v.deleteMsg,M=v.setTyping,k=v.resetList,K=Object(l.useCallback)(function(){var e=Object(i.a)(Object(r.a)().mark((function e(t,a){var n,c;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("text"!==t||!a.trim()){e.next=14;break}return b(!0),n=setTimeout((function(){null===g||void 0===g||g.blur()}),500),c=P(a),x(c),A.saveGPTMessageCache(c),M(!0),e.next=9,w(a);case 9:e.sent.forEach((function(e){var t=e.text,a=e.status,n=G(t,a);x(n),A.saveGPTMessageCache(n)})),b(!1),setTimeout((function(){n&&clearTimeout(n),null===g||void 0===g||g.focus()}),500),Object(d.a)("ChatGPT_SendMessage");case 14:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),[x,M,g]),U=Object(l.useCallback)((function(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c.JoinService,t=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,s="";switch(e){case c.JoinService:case c.UseNotice:case c.AboutCache:s=N[e];break;case c.CleanCache:s=N[e],S(t,a);break;case c.UseSelfKey:A.openAIMsgId&&n(A.openAIMsgId),a(G("","sent","useSelf"))}return G(s)}(e.code,k,x,I),n=a.current.querySelector(".PullToRefresh");t.content.text&&x(t),null===n||void 0===n||n.scrollTo({top:null===n||void 0===n?void 0:n.scrollHeight})}),[x,k,I]),J=Object(l.useCallback)((function(e){!g&&C(e.currentTarget),u&&(null===g||void 0===g||g.blur())}),[g,u]);return Object(H.jsx)(p.a,{ref:a,messages:m,quickReplies:T,onSend:K,onInputFocus:J,onQuickReplyClick:U,renderMessageContent:function(e){return Object(H.jsx)(Y,Object(f.a)(Object(f.a)({},e),{},{updateMsg:y}))}})}),$=a(836),D=a.n($);t.default=Object(u.a)((function(e){var t=e.mode,a=Object(l.useState)(!1),n=Object(o.a)(a,2),c=n[0],u=n[1];return Object(l.useEffect)((function(){Object(i.a)(Object(r.a)().mark((function e(){return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.init();case 2:u(!0);case 3:case"end":return e.stop()}}),e)})))()}),[]),Object(H.jsx)("div",{className:D.a.content,children:j.a.userHealth?c&&Object(H.jsxs)(H.Fragment,{children:[Object(H.jsx)(Z,{list:A.chatMessageList}),A.isUseCustom&&Object(H.jsx)("div",{className:D.a.useCustom,children:Object(H.jsx)(s.a,{title:"\u5df2\u542f\u7528\u4e13\u5c5e\u6a21\u5f0f",children:Object(H.jsx)(b.a,{})})})]}):Object(H.jsx)("div",{className:D.a.loginNotice,children:"newtab"===t?Object(H.jsx)("a",{href:h.d,target:"_self",children:"\u767b\u5f55\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55~"}):Object(H.jsx)("a",{href:h.g,target:"_blank",rel:"noreferrer",children:"\u767b\u5f55\u5f02\u5e38\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55~"})})})}))},678:function(e,t,a){e.exports={markdown:"markdown--lzwru",selfCard:"selfCard--utGK6",notice:"notice--QnAPU",form:"form--H9J0K",actions:"actions--Zp4z8"}},836:function(e,t,a){e.exports={content:"content--NYE50",loginNotice:"loginNotice--AlnmX",useCustom:"useCustom--3suSf"}}}]);