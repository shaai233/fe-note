(this.webpackJsonpktool=this.webpackJsonpktool||[]).push([[31],{1735:function(e,t,n){"use strict";n.r(t);var c,a=n(0),r=(n(600),n(608)),i=(n(437),n(286)),s=(n(109),n(41)),o=(n(271),n(130)),l=(n(781),n(850)),d=(n(305),n(188)),u=(n(85),n(44)),j=n(5),p=(n(74),n(27)),b=n(42),m=n(658),O=n(48),h=n(8),f=n(15),x=n(2),v=n(19),g=n(18),k=n(28),N=n(21),y=n(16),C=n(289),S=new(n(783).a)({env:"production",bizName:"adFrontendChromePlugin"}),P=n(49),_=n(31);!function(e){e[e.Image=0]="Image",e[e.Video=1]="Video",e[e.Other=2]="Other"}(c||(c={}));var w=function(e){var t=1024,n=t*t;return e>n?"".concat((e/n).toFixed(1),"MB"):e>t/10?"".concat((e/t).toFixed(1),"KB"):"".concat(e,"Byte")},I=[{domain:".kuaishou.com",names:["_did","userId","did","apdid"]},{domain:"kcdn.corp.kuaishou.com",names:["auth"]},{domain:".kcdn.corp.kuaishou.com",names:["accessproxy_session"]},{domain:".corp.kuaishou.com",names:["admin_corp_tk"]}],F={pid:"",token:"",quality:100,projectName:"",urlPlaceholder:""},z={size:"",cdnUrl:"",fileName:"",originFileSize:0,compressedFileSize:0,srcType:c.Other},K=Object(v.a)((function e(){var t=this;Object(g.a)(this,e),this.result=Object(x.a)({},z),this.uploadConfig=Object(x.a)({},F),this.kcdnProjectList=[],this.hasKcdnProject=!1,this.init=Object(f.a)(Object(h.a)().mark((function e(){var n;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){try{var t,n;null===(t=chrome)||void 0===t||null===(n=t.cookies)||void 0===n||n.getAll({domain:".kuaishou.com"},(function(t){var n,c="",a=I.map((function(e){return e.domain})),r=t.filter((function(e){return a.includes(e.domain)})),i=Object(C.a)(r);try{var s=function(){var e=n.value,t=I.filter((function(t){return t.domain===e.domain}))[0];e.domain===t.domain&&t.names.includes(e.name)&&e.value&&(c=c?"".concat(c,";").concat(e.name,"=").concat(e.value):"".concat(e.name,"=").concat(e.value))};for(i.s();!(n=i.n()).done;)s()}catch(o){i.e(o)}finally{i.f()}P.a.post("".concat(_.e,"/rest/kcdn/getPidTokens"),{cookie:c}).then(function(){var t=Object(f.a)(Object(h.a)().mark((function t(n){var c,a,r,i,s,o;return Object(h.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(N.b)(k.a.PopKcdnProjects);case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0="[]";case 5:return i=t.t0,t.t1=JSON,t.next=9,Object(N.b)(k.a.PopKcdnAdvance);case 9:if(t.t2=t.sent,t.t2){t.next=12;break}t.t2="{}";case 12:t.t3=t.t2,s=t.t1.parse.call(t.t1,t.t3),o=JSON.parse(i),1===n.result&&(null===(c=n.data)||void 0===c||null===(a=c.list)||void 0===a?void 0:a.length)&&(o=o.concat(null===(r=n.data)||void 0===r?void 0:r.list)),o=o.filter((function(e,t){return o.findIndex((function(t){return t.project_name_en===e.project_name_en}))===t})),Object(N.e)(k.a.PopKcdnProjects,JSON.stringify(o||[])),e({merge:o,state:{pid:(null===s||void 0===s?void 0:s.pid)||o.length&&o[0].project_name_en||"",token:(null===s||void 0===s?void 0:s.token)||o.length&&o[0].tokenid||"",quality:+((null===s||void 0===s?void 0:s.quality)||"100"),urlPlaceholder:(null===s||void 0===s?void 0:s.urlPlaceholder)||"",projectName:(null===s||void 0===s?void 0:s.projectName)||""}});case 19:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}))}catch(c){S.trace({error:JSON.stringify(c),message:"SetKcdnError"}),e(void 0)}}));case 2:(n=e.sent)&&Object(y.p)((function(){t.kcdnProjectList=n.merge,t.uploadConfig=Object(x.a)({},n.state),t.hasKcdnProject=!!t.kcdnProjectList.length}));case 4:case"end":return e.stop()}}),e)}))),this.updateSetting=function(e){t.uploadConfig=Object(x.a)(Object(x.a)({},t.uploadConfig),e),Object(N.e)(k.a.PopKcdnAdvance,JSON.stringify(t.uploadConfig))},this.updateResult=function(e){t.result=Object(x.a)(Object(x.a)({},t.result),e)},Object(y.n)(this,{result:y.o,uploadConfig:y.o,kcdnProjectList:y.o,hasKcdnProject:y.o}),this.init()})),L=new K,D=n(784),U=n.n(D),T=n(1),R=function(e){p.b.success("\u5df2\u4fdd\u5b58"),L.updateSetting(e)},q=Object(b.a)((function(){var e=L.uploadConfig,t=L.kcdnProjectList,n=Object(a.useState)([]),c=Object(j.a)(n,2),p=c[0],b=c[1],h=Object(a.useState)(),f=Object(j.a)(h,2),x=f[0],v=f[1],g=Object(a.useCallback)((function(){b([])}),[]);return Object(a.useEffect)((function(){t.find((function(t){return e.pid===t.project_name_en}))&&v(e.pid)}),[e,t]),Object(T.jsxs)("div",{className:U.a.adVance,children:[Object(T.jsx)(i.a,{activeKey:p,onChange:function(e){(null===e||void 0===e?void 0:e.length)&&Object(O.a)("kcdnAdvanceOpen"),b(e)},children:Object(T.jsxs)(i.a.Panel,{header:"\u9ad8\u7ea7\u8bbe\u7f6e",children:[Object(T.jsxs)(m.a,{label:"\u9879\u76ee\u7a7a\u95f4",isPointer:0===t.length,children:[Object(T.jsxs)("div",{className:U.a.notice,children:["\u70b9\u51fb\u8fdb\u5165",Object(T.jsx)("a",{href:"https://kcdn.corp.kuaishou.com/system/",target:"_blank",rel:"noreferrer",children:"KCDN"}),"\u540e\uff0c\u518d\u5c1d\u8bd5\u9009\u62e9\u9879\u76ee\u7a7a\u95f4"]}),Object(T.jsx)("div",{className:U.a.pidWrap,id:"kcdn-pid-container",children:Object(T.jsx)(d.a,{onChange:function(e){var n=t.find((function(t){return t.project_name_en===e}));n&&R({pid:n.project_name_en,token:n.tokenid,projectName:n.project_name}),v(e)},className:U.a.pidSelect,dropdownClassName:U.a.dropSelect,placeholder:t.length?"\u8bf7\u9009\u62e9\u60a8\u7684\u9879\u76ee\u540d\u79f0":"\u8bf7\u524d\u5f80KCDN\uff0c\u5c06\u81ea\u52a8\u540c\u6b65\u7a7a\u95f4\u5217\u8868",value:x,getPopupContainer:function(){return document.querySelector("#kcdn-pid-container")},children:t.map((function(e){return Object(T.jsx)(d.a.Option,{value:e.project_name_en,children:Object(T.jsx)(u.a,{title:e.project_name,children:e.project_name})})}))})})]}),Object(T.jsxs)(m.a,{label:"\u56fe\u7247\u8d28\u91cf",children:[Object(T.jsx)("div",{className:U.a.notice,children:"\u53ea\u5bf9\u56fe\u7247\u6587\u4ef6\u6709\u6548"}),Object(T.jsx)(l.a,{value:e.quality,min:1,marks:{30:"\u5dee",60:"\u826f",80:"\u4f18",100:"\u539f\u56fe"},tooltipVisible:!1,step:null,onChange:function(e){R({quality:e})}})]}),Object(T.jsxs)(m.a,{label:"URL\u91cd\u5199",children:[Object(T.jsxs)("div",{className:U.a.notice,children:["\u8fd4\u56de\u6307\u5b9aURL\uff08\u7279\u5b9a\u57df\u540d\u6216\u5360\u4f4d\u7b26\uff09",Object(T.jsx)("br",{}),"\u4f8b\u5982\uff1a//xx.imgs.comm\u6216https://$","{CDN_URL}"]}),Object(T.jsx)(o.a,{placeholder:"//xx.imgs.com\u6216${CDN_URL}",value:e.urlPlaceholder,onChange:function(e){var t;t=e.target.value,R({urlPlaceholder:t})}})]}),Object(T.jsx)("div",{className:U.a.buttonGroup,children:Object(T.jsx)(s.a,{onClick:g,type:"text",children:"\u6536\u8d77"})})]},"1")}),Object(T.jsx)(r.a,{showIcon:!0,className:U.a.kcdnNotice,type:L.hasKcdnProject?"success":"error",message:L.hasKcdnProject?L.uploadConfig.projectName:"\u672a\u8bbe\u7f6e\u9879\u76ee",description:L.hasKcdnProject?"":"\u8bf7\u5728\u9ad8\u7ea7\u8bbe\u7f6e\u4e2d\u9009\u62e9\u4f60\u7684KCDN\u9879\u76ee"})]})})),E=(n(646),n(679)),J=n(515),M=n(101),W=n(127),B=function(){var e=Object(f.a)(Object(h.a)().mark((function e(){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.t0=JSON,e.next=4,Object(N.b)(k.a.PopKcdnHistory);case 4:if(e.t1=e.sent,e.t1){e.next=7;break}e.t1="[]";case 7:return e.t2=e.t1,e.abrupt("return",e.t0.parse.call(e.t0,e.t2));case 11:return e.prev=11,e.t3=e.catch(0),e.abrupt("return",[]);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}(),V=function(){var e=Object(f.a)(Object(h.a)().mark((function e(t){var n;return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,B();case 3:(n=e.sent).unshift(t),Object(N.e)(k.a.PopKcdnHistory,JSON.stringify(n)),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}(),G=n(785),H=n.n(G),A="".concat(_.e,"/rest/kcdn"),Y=Object(b.a)((function(){var e=L.uploadConfig,t=L.updateResult,n=Object(a.useState)(!1),r=Object(j.a)(n,2),i=r[0],s=r[1],o=Object(a.useCallback)((function(e){var n=function(e){var t=e.fileResults.find((function(e){return""!==e.cdnUrl}));return!!t&&t.cdnUrl}(e);if(n){var a=e.srcType,r=e.originFileSize,i=e.compressedFileSize,o={cdnUrl:n,srcType:a};a===c.Image&&(o.originFileSize=r,o.compressedFileSize=i),t(o),V({url:n,type:a,createTime:Date.now()}),s(!0),p.b.success("\u4e0a\u4f20\u6210\u529f")}else p.b.error("\u4e0a\u4f20\u5931\u8d25")}),[t]),l=Object(a.useCallback)((function(e){var t=e.file,n=t.response,c=t.status;if("uploading"===c)p.b.warning("\u6b63\u5728\u4e0a\u4f20",100);else if("done"===c&&n&&1===n.result&&0===+n.data.code)o(n.data);else{var a;p.b.error((null===n||void 0===n||null===(a=n.data)||void 0===a?void 0:a.message)||(null===n||void 0===n?void 0:n.message))}}),[o]),d=Object(a.useCallback)((function(n){return e.pid?(t({fileName:n.name,size:"".concat(n.size/1024,"KB")}),!0):(p.b.error("\u8bf7\u5728\u9ad8\u7ea7\u8bbe\u7f6e\u4e2d\u9009\u62e9kcdn\u9879\u76ee"),E.a.LIST_IGNORE)}),[t,e.pid]),u=Object(a.useCallback)((function(t){var n,c;if(null!==(n=t.clipboardData)&&void 0!==n&&null!==(c=n.files)&&void 0!==c&&c.length){if(!e.pid)return p.b.error("\u8bf7\u5728\u9ad8\u7ea7\u8bbe\u7f6e\u4e2d\u9009\u62e9kcdn\u9879\u76ee"),E.a.LIST_IGNORE;p.b.warning("\u6b63\u5728\u4e0a\u4f20",100),Object(M.e)(t,"kcdn_upload",A,Object(x.a)({},e)).then((function(e){o(e.data)})).catch((function(e){p.b.error("\u4e0a\u4f20\u5931\u8d25")}))}}),[e,o]);return Object(a.useEffect)((function(){return document.onpaste=u,function(){document.removeEventListener("paste",u)}}),[u]),Object(T.jsx)("div",{className:H.a.uploader,children:Object(T.jsx)(E.a.Dragger,{name:"kcdn_upload",accept:"*",action:A,data:e,showUploadList:!0,onChange:l,beforeUpload:d,children:Object(T.jsxs)("div",{className:H.a.uploaderInner,children:[Object(T.jsx)(J.a,{className:H.a.icon}),Object(T.jsx)("p",{className:H.a.text,children:"\u6253\u5f00/\u62d6\u62fd/\u7c98\u8d34Ctrl+V"}),Object(T.jsx)("p",{className:H.a.text,children:i?"\u4e0a\u4f20\u5b8c\u6210\uff0c\u53ef\u4ee5\u7ee7\u7eed\u4e0a\u4f20\u54e6~":"\u4e0a\u4f20\u6587\u4ef6"}),Object(T.jsx)("p",{className:H.a.tip,children:"\u540c\u540d\u8986\u76d6-\u7981\u7528\u3001Hash-\u5f00\u542f"})]})})})})),Q=(n(149),n(87)),Z=n(1761),X=(n(278),n(150)),$=n(83),ee=n.n($),te=n(576),ne=n(97),ce=n(1739),ae=n(1740),re=n(1741),ie=n(980),se=n(660),oe=n.n(se),le=function(e){var t=e.item,n=t.type===c.Image;return Object(T.jsx)("div",{className:oe.a.detail,children:Object(T.jsx)(u.a,{overlayClassName:oe.a.tooltip,getPopupContainer:function(){return document.querySelector("#kcdn-record-container")},title:n?Object(T.jsx)("img",{src:t.url,alt:"\u9884\u89c8\u5931\u8d25"}):"\u6682\u4e0d\u652f\u6301\u9884\u89c8",children:Object(T.jsxs)("div",{className:oe.a.link,children:[n?Object(T.jsx)(ce.a,{}):Object(T.jsx)(ae.a,{}),t.url]})})})},de=function(){var e=Object(te.a)([]),t=Object(j.a)(e,2),n=t[0],c=t[1],r=Object(a.useCallback)((function(e){c(function(e,t){var n=Object(W.a)(e).slice(0),c=n.findIndex((function(e){return e.url===t.url}));return~c&&(n.splice(c,1),Object(N.e)(k.a.PopKcdnHistory,JSON.stringify(n))),n}(n,e))}),[n,c]);return Object(a.useEffect)((function(){Object(f.a)(Object(h.a)().mark((function e(){return Object(h.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=c,e.next=3,B();case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})))()}),[c]),Object(T.jsx)("div",{className:oe.a.recordList,id:"kcdn-record-container",children:n.length?n.map((function(e,t){return Object(T.jsxs)("div",{className:oe.a.recordItem,children:[Object(T.jsx)(le,{item:e}),Object(T.jsxs)("div",{className:oe.a.desc,children:[Object(T.jsxs)("div",{className:oe.a.time,children:["\u4e0a\u4f20\u65f6\u95f4\uff1a",ee()(+e.createTime).format("YYYY-MM-DD HH:mm:ss")]}),Object(T.jsxs)("div",{className:oe.a.desc,children:[Object(T.jsxs)("div",{className:oe.a.action,onClick:function(){return Object(ne.b)(e.url)},children:[Object(T.jsx)(re.a,{}),"\u590d\u5236\u5730\u5740"]}),Object(T.jsx)(X.a,{title:"\u786e\u5b9a\u8981\u5220\u9664\u8fd9\u6761\u8bb0\u5f55\u5417\uff1f",okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",placement:"topRight",onConfirm:r.bind(null,e),children:Object(T.jsxs)("div",{className:oe.a.action,children:[Object(T.jsx)(ie.a,{className:oe.a.deleteIcon}),"\u5220\u9664\u8bb0\u5f55"]})})]})]})]},t)})):Object(T.jsx)("div",{className:oe.a.empty,children:"\u8fd8\u6ca1\u6709\u8bb0\u5f55~"})})},ue=function(){var e=Object(a.useState)(!1),t=Object(j.a)(e,2),n=t[0],c=t[1],r=Object(a.useCallback)((function(){c(!0)}),[]);return Object(T.jsxs)(T.Fragment,{children:[Object(T.jsxs)(s.a,{type:"primary",className:oe.a.record,onClick:r,children:[Object(T.jsx)(Z.a,{}),Object(T.jsx)("span",{className:oe.a.text,children:"\u4e0a\u4f20\u8bb0\u5f55"})]}),Object(T.jsx)(Q.a,{title:"\u6587\u4ef6\u4e0a\u4f20\u8bb0\u5f55",placement:"right",open:n,getContainer:!1,className:oe.a.recordDrawer,onClose:function(){return c(!1)},children:n&&Object(T.jsx)(de,{})})]})},je=(n(301),n(124)),pe=(n(563),n(564)),be=(n(440),n(334)),me=n(98),Oe=n.n(me),he=n(786),fe=n.n(he),xe=function(e){var t=e.result;return Object(T.jsx)(u.a,{title:"\u538b\u7f29\u6bd4\uff1a".concat((100*(1-t.compressedFileSize/t.originFileSize)).toFixed(1),"%"),children:Object(T.jsx)(be.a,{className:fe.a.progress,percent:+(t.compressedFileSize/t.originFileSize*100).toFixed(1),strokeColor:"#92ed14",trailColor:"#1890ff",format:function(){return Object(T.jsxs)("div",{children:[Object(T.jsx)("span",{className:fe.a.compressedSize,children:w(t.compressedFileSize)+" / "}),Object(T.jsx)("span",{className:fe.a.originSize,children:w(t.originFileSize)})]})}})})},ve=Object(b.a)((function(){var e=L.result,t=L.uploadConfig,n=Object(a.useMemo)((function(){return 100!==+t.quality&&e.cdnUrl&&e.srcType===c.Image&&e.compressedFileSize&&e.originFileSize}),[t.quality,e.cdnUrl,e.srcType,e.compressedFileSize,e.originFileSize]);return Object(T.jsxs)("div",{className:fe.a.uploadRes,children:[Object(T.jsx)(pe.a,{orientation:"center",children:"\u4e0a\u4f20\u7ed3\u679c"}),Object(T.jsxs)("div",{className:fe.a.content,children:[n&&Object(T.jsx)(xe,{result:e}),e.cdnUrl?Object(T.jsxs)(T.Fragment,{children:[Object(T.jsx)("div",{className:fe.a.url,children:e.cdnUrl}),Object(T.jsx)(Oe.a,{text:e.cdnUrl,onCopy:function(){return p.b.success("\u590d\u5236\u6210\u529f")},children:Object(T.jsx)(s.a,{className:fe.a.copyBtn,type:"primary",block:!0,children:"\u590d\u5236CDN\u94fe\u63a5"})})]}):Object(T.jsx)(je.a,{image:je.a.PRESENTED_IMAGE_SIMPLE,description:"\u6682\u65e0\u6570\u636e\uff0c\u5feb\u53bb\u4e0a\u4f20\u5427\uff5e"})]})]})})),ge=n(787),ke=n.n(ge);t.default=function(){return Object(T.jsxs)("div",{className:ke.a.kcdnContainer,children:[Object(T.jsx)(ue,{}),Object(T.jsx)(q,{}),Object(T.jsx)(Y,{}),Object(T.jsx)(ve,{})]})}},658:function(e,t,n){"use strict";n(85);var c=n(44),a=(n(0),n(659)),r=n.n(a),i=n(146),s=n(1);t.a=function(e){return Object(s.jsxs)("div",{className:r.a.panelItem,children:[Object(s.jsxs)("div",{className:"".concat(r.a.label," ").concat(e.labelClass),children:[Object(s.jsx)("span",{className:"".concat(e.required?r.a.required:""),children:e.label}),Object(s.jsx)(c.a,{title:e.iconTipText,children:e.icon&&Object(s.jsxs)("div",{className:r.a.icon,children:[Object(s.jsx)("span",{children:e.icon}),e.isPointer&&Object(s.jsx)(i.a,{storageKey:"kcdn-pid-guideHand",className:r.a.hand})]})})]}),Object(s.jsx)("div",{className:"".concat(r.a.content," ").concat(e.contentClass),children:e.children})]})}},659:function(e,t,n){e.exports={panelItem:"panelItem--bAqB0",label:"label--WUwRm",icon:"icon--KDvps",hand:"hand--yQkc+",content:"content--0yu4l",required:"required--X2QR2"}},660:function(e,t,n){e.exports={record:"record--7cpWu",text:"text--eWKbp",recordDrawer:"recordDrawer--TfBee",recordList:"recordList--vkldM",recordItem:"recordItem--XynYJ",detail:"detail--nO1vk",link:"link--tQgL9",desc:"desc--ZT0FE",time:"time--xVDwh",action:"action--xzACQ",deleteIcon:"deleteIcon--wYhd0",empty:"empty--yZ+2l",tooltip:"tooltip--UWZ9l"}},784:function(e,t,n){e.exports={adVance:"adVance--Fbjyt",pidWrap:"pidWrap--Gx0he",noList:"noList--3+GVw",pidSelect:"pidSelect--r2lpF",notice:"notice--WhrWE",buttonGroup:"buttonGroup--OL1hM",kcdnNotice:"kcdnNotice--BLsS4",dropSelect:"dropSelect--FjLas"}},785:function(e,t,n){e.exports={uploader:"uploader--uOOdM",uploaderInner:"uploaderInner--72pnP",icon:"icon--5m1Pt",text:"text--ZQCUW",tip:"tip--j5KLz"}},786:function(e,t,n){e.exports={uploadRes:"uploadRes--g1MQD",content:"content--I+bWJ",progress:"progress--lkwv6",url:"url--uHxux",copyBtn:"copyBtn--MhY5J"}},787:function(e,t,n){e.exports={kcdnContainer:"kcdnContainer---m1Cr"}}}]);